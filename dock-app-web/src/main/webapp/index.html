<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <title>Vue Prototype</title>

    <script src="resources/js/vue-bundle.js"></script>
  </head>

  <body>

    <div id="app" class="container">
      <alert v-model="showErrorAlert" placement="top" duration="3000" type="danger" width="400px" dismissable>
        <strong>Update not performed</strong>
        <p>There was an issue processing your request</p>
      </alert>
      <div >
        <h1 class="display-1">Names on File</h1>
      </div>

      <client-table :row-info-list="rows" :header-info-list="cols"></client-table>
    </div>
  </body>

  <script>
    var app = new Vue({
      el:'#app',
      mounted(){
        this.cols = this.buildColumnList();
        this.getNames();
      },
      data:{
        rows:[],
        cols:[],
        showErrorAlert:false
      },
      methods:{
        getNames:function(){
          $.get('/dockapp/nameentry').done(function(result){
            app.assignNames(result);
          })
        },
        assignNames:function(names){
          _.forEach(names,function(name){
            app.rows.push(app.formatRow(name));
          });
        },
        formatRow:function(val){
          var row = [];
          row[0] = val.name;
          row[1] = new Date(val.updated).toDateString();
          row.id = val.id;
          return row;
        },
        editName:function(row, newVal){
          var nameEntry = {};
          nameEntry.name = newVal;
          nameEntry.id = row.id;
          $.ajax({
            url:'/dockapp/nameentry/'+row[0],
            type:'PUT',
            data:JSON.stringify(nameEntry),
            contentType: 'application/json',
            success: function(response){
              app.rows.splice(row.rowKey,1,app.formatRow(response));
            },
            error: function(error){
              app.showErrorAlert = true;
            }
          })
        },
         buildColumnList: function() {
          return [
              {value:"Name", editFunction:this.editName, sortable:true, defaultSort:true},
              {value:"Date Updated"}
          ]
        }
      }
    });
  </script>

</html>
